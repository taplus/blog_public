<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>NUC11 AIO 折腾小记 | tannat</title>
<meta name=keywords content><meta name=description content="这是一份做了五个月的作业，花费了不少时间、精力、金钱，写在这里做个记录。
硬件选型
我日常使用的设备是一台 16G + 256G 的 M2 Mac  Mini，托「库存克星」的福，日常使用的槽点就是逼仄的存储空间和羸弱的游戏性能。我拒绝继续向果子充钱，因此组台能填补这两块短板的 AIO 就提上了日程，由于空间限制和噪音敏感，我一开始的选型就瞄准在了小体积、全闪存和能塞得下一张显卡的小主机上。
经过一段时间的寻找，已经停产了的 NUC 9  幽灵峡谷成了唯一候选。5L 的小体积塞的下 20cm 长的双槽显卡，配备了3 块 m2 硬盘位，外加 1 个 sata 共计 4 块硬盘，背部配了两个雷电 3 接口，还有白金的 500W Flex 电源，简直就是量身定制。更重要的是截至 2024 年年中，在第三方平台上 i7 版本仅需 1500 就能到手，因此果断下单。然而由于一些原因，我最终换成了 NUC 11。相较 NUC 9，NUC11 Extreme 猛兽峡谷体积大了两圈来到了 8.4 L， CPU 从 9 代笔记本标压 U 升级为 10nm 制程的 i7-11700B，相应的 PCIE 3 升级到了 PCIE 4，雷电 3 升级到雷电 4 。但精巧的 Flex 白金电源降级为 SFX 金牌电源，整体精致感也少了很多，换来的是更强的性能，只能说有失有得吧。
机子只是台准系统，我加装了 64GB DDR4 3200内存，配了一张华硕 4060 Dual 显卡用来直通给 Win10 虚拟机。存储方面是氪金大头，作为一台全闪 AIO，用满了 NUC 11 的4块 m2 存储位：3块 4T 联芸 MAP1602 + 长江存储 232 层 TLC 组建 raidz1 阵列，实现全闪、全万兆的性能。 外加 1 块 1T 的 SN580 直通给 Windows。"><meta name=author content><link rel=canonical href=https://tannat.me/posts/nuc11-aio-tinkering/><link crossorigin=anonymous href=/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://tannat.me/static/favicon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://tannat.me/static/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://tannat.me/static/favicon/favicon-32x32.png><link rel=apple-touch-icon href=https://tannat.me/static/favicon/apple-touch-icon.png><link rel=mask-icon href=https://tannat.me/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://tannat.me/posts/nuc11-aio-tinkering/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://tannat.me/posts/nuc11-aio-tinkering/"><meta property="og:site_name" content="tannat"><meta property="og:title" content="NUC11 AIO 折腾小记"><meta property="og:description" content="这是一份做了五个月的作业，花费了不少时间、精力、金钱，写在这里做个记录。
硬件选型 我日常使用的设备是一台 16G + 256G 的 M2 Mac Mini，托「库存克星」的福，日常使用的槽点就是逼仄的存储空间和羸弱的游戏性能。我拒绝继续向果子充钱，因此组台能填补这两块短板的 AIO 就提上了日程，由于空间限制和噪音敏感，我一开始的选型就瞄准在了小体积、全闪存和能塞得下一张显卡的小主机上。
经过一段时间的寻找，已经停产了的 NUC 9 幽灵峡谷成了唯一候选。5L 的小体积塞的下 20cm 长的双槽显卡，配备了3 块 m2 硬盘位，外加 1 个 sata 共计 4 块硬盘，背部配了两个雷电 3 接口，还有白金的 500W Flex 电源，简直就是量身定制。更重要的是截至 2024 年年中，在第三方平台上 i7 版本仅需 1500 就能到手，因此果断下单。然而由于一些原因，我最终换成了 NUC 11。相较 NUC 9，NUC11 Extreme 猛兽峡谷体积大了两圈来到了 8.4 L， CPU 从 9 代笔记本标压 U 升级为 10nm 制程的 i7-11700B，相应的 PCIE 3 升级到了 PCIE 4，雷电 3 升级到雷电 4 。但精巧的 Flex 白金电源降级为 SFX 金牌电源，整体精致感也少了很多，换来的是更强的性能，只能说有失有得吧。
机子只是台准系统，我加装了 64GB DDR4 3200内存，配了一张华硕 4060 Dual 显卡用来直通给 Win10 虚拟机。存储方面是氪金大头，作为一台全闪 AIO，用满了 NUC 11 的4块 m2 存储位：3块 4T 联芸 MAP1602 + 长江存储 232 层 TLC 组建 raidz1 阵列，实现全闪、全万兆的性能。 外加 1 块 1T 的 SN580 直通给 Windows。"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-07-23T00:00:00+00:00"><meta property="article:modified_time" content="2024-07-23T00:00:00+00:00"><meta property="og:image" content="https://tannat.me/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://tannat.me/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="NUC11 AIO 折腾小记"><meta name=twitter:description content="这是一份做了五个月的作业，花费了不少时间、精力、金钱，写在这里做个记录。
硬件选型
我日常使用的设备是一台 16G + 256G 的 M2 Mac  Mini，托「库存克星」的福，日常使用的槽点就是逼仄的存储空间和羸弱的游戏性能。我拒绝继续向果子充钱，因此组台能填补这两块短板的 AIO 就提上了日程，由于空间限制和噪音敏感，我一开始的选型就瞄准在了小体积、全闪存和能塞得下一张显卡的小主机上。
经过一段时间的寻找，已经停产了的 NUC 9  幽灵峡谷成了唯一候选。5L 的小体积塞的下 20cm 长的双槽显卡，配备了3 块 m2 硬盘位，外加 1 个 sata 共计 4 块硬盘，背部配了两个雷电 3 接口，还有白金的 500W Flex 电源，简直就是量身定制。更重要的是截至 2024 年年中，在第三方平台上 i7 版本仅需 1500 就能到手，因此果断下单。然而由于一些原因，我最终换成了 NUC 11。相较 NUC 9，NUC11 Extreme 猛兽峡谷体积大了两圈来到了 8.4 L， CPU 从 9 代笔记本标压 U 升级为 10nm 制程的 i7-11700B，相应的 PCIE 3 升级到了 PCIE 4，雷电 3 升级到雷电 4 。但精巧的 Flex 白金电源降级为 SFX 金牌电源，整体精致感也少了很多，换来的是更强的性能，只能说有失有得吧。
机子只是台准系统，我加装了 64GB DDR4 3200内存，配了一张华硕 4060 Dual 显卡用来直通给 Win10 虚拟机。存储方面是氪金大头，作为一台全闪 AIO，用满了 NUC 11 的4块 m2 存储位：3块 4T 联芸 MAP1602 + 长江存储 232 层 TLC 组建 raidz1 阵列，实现全闪、全万兆的性能。 外加 1 块 1T 的 SN580 直通给 Windows。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://tannat.me/posts/"},{"@type":"ListItem","position":2,"name":"NUC11 AIO 折腾小记","item":"https://tannat.me/posts/nuc11-aio-tinkering/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"NUC11 AIO 折腾小记","name":"NUC11 AIO 折腾小记","description":"这是一份做了五个月的作业，花费了不少时间、精力、金钱，写在这里做个记录。\n硬件选型 我日常使用的设备是一台 16G + 256G 的 M2 Mac Mini，托「库存克星」的福，日常使用的槽点就是逼仄的存储空间和羸弱的游戏性能。我拒绝继续向果子充钱，因此组台能填补这两块短板的 AIO 就提上了日程，由于空间限制和噪音敏感，我一开始的选型就瞄准在了小体积、全闪存和能塞得下一张显卡的小主机上。\n经过一段时间的寻找，已经停产了的 NUC 9 幽灵峡谷成了唯一候选。5L 的小体积塞的下 20cm 长的双槽显卡，配备了3 块 m2 硬盘位，外加 1 个 sata 共计 4 块硬盘，背部配了两个雷电 3 接口，还有白金的 500W Flex 电源，简直就是量身定制。更重要的是截至 2024 年年中，在第三方平台上 i7 版本仅需 1500 就能到手，因此果断下单。然而由于一些原因，我最终换成了 NUC 11。相较 NUC 9，NUC11 Extreme 猛兽峡谷体积大了两圈来到了 8.4 L， CPU 从 9 代笔记本标压 U 升级为 10nm 制程的 i7-11700B，相应的 PCIE 3 升级到了 PCIE 4，雷电 3 升级到雷电 4 。但精巧的 Flex 白金电源降级为 SFX 金牌电源，整体精致感也少了很多，换来的是更强的性能，只能说有失有得吧。\n机子只是台准系统，我加装了 64GB DDR4 3200内存，配了一张华硕 4060 Dual 显卡用来直通给 Win10 虚拟机。存储方面是氪金大头，作为一台全闪 AIO，用满了 NUC 11 的4块 m2 存储位：3块 4T 联芸 MAP1602 + 长江存储 232 层 TLC 组建 raidz1 阵列，实现全闪、全万兆的性能。 外加 1 块 1T 的 SN580 直通给 Windows。\n","keywords":[],"articleBody":"这是一份做了五个月的作业，花费了不少时间、精力、金钱，写在这里做个记录。\n硬件选型 我日常使用的设备是一台 16G + 256G 的 M2 Mac Mini，托「库存克星」的福，日常使用的槽点就是逼仄的存储空间和羸弱的游戏性能。我拒绝继续向果子充钱，因此组台能填补这两块短板的 AIO 就提上了日程，由于空间限制和噪音敏感，我一开始的选型就瞄准在了小体积、全闪存和能塞得下一张显卡的小主机上。\n经过一段时间的寻找，已经停产了的 NUC 9 幽灵峡谷成了唯一候选。5L 的小体积塞的下 20cm 长的双槽显卡，配备了3 块 m2 硬盘位，外加 1 个 sata 共计 4 块硬盘，背部配了两个雷电 3 接口，还有白金的 500W Flex 电源，简直就是量身定制。更重要的是截至 2024 年年中，在第三方平台上 i7 版本仅需 1500 就能到手，因此果断下单。然而由于一些原因，我最终换成了 NUC 11。相较 NUC 9，NUC11 Extreme 猛兽峡谷体积大了两圈来到了 8.4 L， CPU 从 9 代笔记本标压 U 升级为 10nm 制程的 i7-11700B，相应的 PCIE 3 升级到了 PCIE 4，雷电 3 升级到雷电 4 。但精巧的 Flex 白金电源降级为 SFX 金牌电源，整体精致感也少了很多，换来的是更强的性能，只能说有失有得吧。\n机子只是台准系统，我加装了 64GB DDR4 3200内存，配了一张华硕 4060 Dual 显卡用来直通给 Win10 虚拟机。存储方面是氪金大头，作为一台全闪 AIO，用满了 NUC 11 的4块 m2 存储位：3块 4T 联芸 MAP1602 + 长江存储 232 层 TLC 组建 raidz1 阵列，实现全闪、全万兆的性能。 外加 1 块 1T 的 SN580 直通给 Windows。\n软件方案 宿主机系统：用 Windows + hyperV 很方便，但 Win 下的 hyperV 不支持硬件直通，转而选择了比较熟悉的 PVE作为宿主机系统。 PVE 安装在 U 盘里，可以省下一个硬盘位。考虑到 U 盘读写性能，PVE配置无SWAP，local 仅存放 truenas 引导，Windows 单独直通一块 SSD 使用，其他虚拟机采用 NFS 存储。\n虚拟机 truenas ：raidz1 阵列可用容量 8T，分配了 16G 的内存。\n虚拟机 Windows ：使用 sunshine + moonlight 远程串流，不玩 FPS，延迟近乎无感。参照这篇文章做了 anti-cheat 配置，同时开启了 Hyper-V 使用 WSL。（所以我的 Windows VM 是跑在第三层嵌套虚拟化上的？）\nUPS 配置：都用 AIO 了，UPS 不能省。虽然这样一来，整套设备又离小体积更远了。参照 chiphell 的这篇文章配置了断电 60s 自动关闭所有虚拟机，180s 关闭宿主机。\n性能测试 存储性能 fio 写性能 3.5 GB/s，读性能 4 GB/s 。 dd 写性能 10.4 GB/s，读性能 16.3 GB/s。 virtio 跑满 20 Gb/s，SMB 3 网络硬盘速度读写大概 3 GB/s。\n雷电网桥性能 truenas 和 Mac Mini 开启 9000 MTU，iperf 3 测试速度 9.29 Gb/s。\nWindows 虚拟机性能 由于 WSL 需求，开启了 Hyper-V 。在性能方面有一些损失，跑了 GeekBench，单核 2000，多核 9000，相较裸机直装损失在10% 左右。\n踩坑 已解决 NUC 11 接 UPS 后执行关机命令后自动重启。 这是由于 BIOS 中配置了USB 自动唤醒，Intel 官方解决方案。 未解决 raidz1 阵列速度问题：fio 本地测试阵列速度，写速度 3.5 GB/s，读速度 4 GB/s，基本只有单盘 PCIE 3 nvme 的速度，远不及 PCIE 4 nvme 速度。目前猜测瓶颈在 CPU 做 raidz1 奇偶校验速度，或者是其中一块 nvme 连在总线的 PCIE 3 通道而非和另外两块一样直连 CPU 的 PCIE 4通道。所以 raidz1 的阵列理论速度到底怎么算？\n雷电传输速度问题：直通给 truenas 的雷电 4 连接 Mac Mini 跑硬盘测试，速度甚至到不了万兆，猜测是雷电网桥的瓶颈，可能是线材的问题或是系统兼容问题。\nNUC 11 计算板有一个 Type-e 接口，买了一个 Type-e 转 USB 的转接器，U 盘用转接器插在这个接口上，结果 BIOS 启动项里根本找不到这个 U 盘。\nF\u0026Q 为什么从 NUC 9 换成 NUC 11 ？ truenas直通 3 块 4T nvme。不知道是硬件问题还是 BIOS 问题，NUC 9 其中一个硬盘位就是没办法直通给虚拟机，在 chiphell 发帖问了下，也没解决方案。另外机器到手后发现，NUC 9 计算板上的两条 m2 ，雷电 3 共享 PCIE 3 x4 的 DMI 总线。最后联系了华硕售后（Intel Nuc 业务已经整体卖给了华硕），客服回电告知没有备件，换了 NUC 11 良品，来回免运费。\n为什么不做存算分离？ 空间限制。而且我玩游戏不多，单独配一台游戏PC没有必要，但不能没有。因此把 4060 放在 AIO 里，4060 待机功耗也不高，后面还可以玩一玩本地 LLM 和 blender 渲染。\n为什么选择 raidz1 ？ mirror 太浪费，raid0 属实亡命之徒，而且我还有一台装了 2T sata 的 J4125小主机，用 Free File Sync 监控 truenas 重要数据文件夹作为备份，兼顾了空间和数据安全。\n功耗如何？ 没有测量过。但 510W 的 UPS 在 AIO 待机状态下显示负载为 10%。游戏满载时负载 35%，NUC 11的 CPU TDP 满载 65W，4060 满载 115W，因此估算待机功耗应该在 60W 左右。\n最后 起步小白，折腾五个月，还有这样那样的小问题，但总算是能用了，其他的后续慢慢学习优化吧。折腾的时候是真痛苦，折腾完了又感觉索然无味。这台机子还有很大的改进空间，后续也可以加装 40G 网卡真正发挥全闪 nas 的实力。但就目前而言，这台机子最大的缺点在于每次看到它，就让我怀念起那台漂亮的、精致小巧的，但被华硕「友好」回收了的幽灵峡谷。看着越来越大的「NUC」，幽灵峡谷真成绝版了，Sad～～～\n","wordCount":"360","inLanguage":"zh","image":"https://tannat.me/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-07-23T00:00:00Z","dateModified":"2024-07-23T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://tannat.me/posts/nuc11-aio-tinkering/"},"publisher":{"@type":"Organization","name":"tannat","logo":{"@type":"ImageObject","url":"https://tannat.me/static/favicon/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://tannat.me/ accesskey=h title="Home (Alt + H)"><img src=https://tannat.me/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://tannat.me/>主页</a>&nbsp;»&nbsp;<a href=https://tannat.me/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">NUC11 AIO 折腾小记</h1><div class=post-meta><span title='2024-07-23 00:00:00 +0000 UTC'>2024-07-23</span></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#硬件选型>硬件选型</a></li><li><a href=#软件方案>软件方案</a></li><li><a href=#性能测试>性能测试</a></li><li><a href=#踩坑>踩坑</a><ul><li><a href=#已解决>已解决</a></li><li><a href=#未解决>未解决</a></li></ul></li><li><a href=#fq>F&amp;Q</a></li><li><a href=#最后>最后</a></li></ul></nav></div></details></div><div class=post-content><p>这是一份做了五个月的作业，花费了不少时间、精力、金钱，写在这里做个记录。</p><h2 id=硬件选型>硬件选型<a hidden class=anchor aria-hidden=true href=#硬件选型>#</a></h2><p>我日常使用的设备是一台 16G + 256G 的 M2 Mac Mini，托「库存克星」的福，日常使用的槽点就是逼仄的存储空间和羸弱的游戏性能。我拒绝继续向果子充钱，因此组台能填补这两块短板的 AIO 就提上了日程，由于空间限制和噪音敏感，我一开始的选型就瞄准在了小体积、全闪存和能塞得下一张显卡的小主机上。</p><p>经过一段时间的寻找，已经停产了的 NUC 9 幽灵峡谷成了唯一候选。5L 的小体积塞的下 20cm 长的双槽显卡，配备了3 块 m2 硬盘位，外加 1 个 sata 共计 4 块硬盘，背部配了两个雷电 3 接口，还有白金的 500W Flex 电源，简直就是量身定制。更重要的是截至 2024 年年中，在第三方平台上 i7 版本仅需 1500 就能到手，因此果断下单。然而由于一些原因，我最终换成了 NUC 11。相较 NUC 9，NUC11 Extreme 猛兽峡谷体积大了两圈来到了 8.4 L， CPU 从 9 代笔记本标压 U 升级为 10nm 制程的 i7-11700B，相应的 PCIE 3 升级到了 PCIE 4，雷电 3 升级到雷电 4 。但精巧的 Flex 白金电源降级为 SFX 金牌电源，整体精致感也少了很多，换来的是更强的性能，只能说有失有得吧。</p><p>机子只是台准系统，我加装了 64GB DDR4 3200内存，配了一张华硕 4060 Dual 显卡用来直通给 Win10 虚拟机。存储方面是氪金大头，作为一台全闪 AIO，用满了 NUC 11 的4块 m2 存储位：3块 4T 联芸 MAP1602 + 长江存储 232 层 TLC 组建 raidz1 阵列，实现全闪、全万兆的性能。 外加 1 块 1T 的 SN580 直通给 Windows。</p><h2 id=软件方案>软件方案<a hidden class=anchor aria-hidden=true href=#软件方案>#</a></h2><ul><li><p>宿主机系统：用 Windows + hyperV 很方便，但 Win 下的 hyperV 不支持硬件直通，转而选择了比较熟悉的 PVE作为宿主机系统。 PVE 安装在 U 盘里，可以省下一个硬盘位。考虑到 U 盘读写性能，PVE配置无SWAP，local 仅存放 truenas 引导，Windows 单独直通一块 SSD 使用，其他虚拟机采用 NFS 存储。</p></li><li><p>虚拟机 truenas ：raidz1 阵列可用容量 8T，分配了 16G 的内存。</p></li><li><p>虚拟机 Windows ：使用 sunshine + moonlight 远程串流，不玩 FPS，延迟近乎无感。参照<a href=https://forum.proxmox.com/threads/windows-11-vm-for-gaming-setup-guide.137718/>这篇文章</a>做了 anti-cheat 配置，同时开启了 Hyper-V 使用 WSL。（所以我的 Windows VM 是跑在第三层嵌套虚拟化上的？）</p></li><li><p>UPS 配置：都用 AIO 了，UPS 不能省。虽然这样一来，整套设备又离小体积更远了。参照 chiphell 的<a href=https://www.chiphell.com/thread-2605539-1-1.html>这篇文章</a>配置了断电 60s 自动关闭所有虚拟机，180s 关闭宿主机。</p></li></ul><h2 id=性能测试>性能测试<a hidden class=anchor aria-hidden=true href=#性能测试>#</a></h2><ul><li><p>存储性能
fio 写性能 3.5 GB/s，读性能 4 GB/s 。
dd 写性能 10.4 GB/s，读性能 16.3 GB/s。
virtio 跑满 20 Gb/s，SMB 3 网络硬盘速度读写大概 3 GB/s。</p></li><li><p>雷电网桥性能
truenas 和 Mac Mini 开启 9000 MTU，iperf 3 测试速度 9.29 Gb/s。</p></li><li><p>Windows 虚拟机性能
由于 WSL 需求，开启了 Hyper-V 。在性能方面有一些损失，跑了 GeekBench，单核 2000，多核 9000，相较裸机直装损失在10% 左右。</p></li></ul><h2 id=踩坑>踩坑<a hidden class=anchor aria-hidden=true href=#踩坑>#</a></h2><h3 id=已解决>已解决<a hidden class=anchor aria-hidden=true href=#已解决>#</a></h3><ul><li>NUC 11 接 UPS 后执行关机命令后自动重启。 这是由于 BIOS 中配置了USB 自动唤醒，Intel 官方<a href=https://www.intel.com/content/www/us/en/support/articles/000089681/intel-nuc.html>解决方案</a>。</li></ul><h3 id=未解决>未解决<a hidden class=anchor aria-hidden=true href=#未解决>#</a></h3><ul><li><p>raidz1 阵列速度问题：fio 本地测试阵列速度，写速度 3.5 GB/s，读速度 4 GB/s，基本只有单盘 PCIE 3 nvme 的速度，远不及 PCIE 4 nvme 速度。目前猜测瓶颈在 CPU 做 raidz1 奇偶校验速度，或者是其中一块 nvme 连在总线的 PCIE 3 通道而非和另外两块一样直连 CPU 的 PCIE 4通道。所以 raidz1 的阵列理论速度到底怎么算？</p></li><li><p>雷电传输速度问题：直通给 truenas 的雷电 4 连接 Mac Mini 跑硬盘测试，速度甚至到不了万兆，猜测是雷电网桥的瓶颈，可能是线材的问题或是系统兼容问题。</p></li><li><p>NUC 11 计算板有一个 Type-e 接口，买了一个 Type-e 转 USB 的转接器，U 盘用转接器插在这个接口上，结果 BIOS 启动项里根本找不到这个 U 盘。</p></li></ul><h2 id=fq>F&amp;Q<a hidden class=anchor aria-hidden=true href=#fq>#</a></h2><ul><li><p>为什么从 NUC 9 换成 NUC 11 ？
truenas直通 3 块 4T nvme。不知道是硬件问题还是 BIOS 问题，NUC 9 其中一个硬盘位就是没办法直通给虚拟机，在 chiphell <a href=https://www.chiphell.com/thread-2613831-1-1.html>发帖</a>问了下，也没解决方案。另外机器到手后发现，NUC 9 计算板上的两条 m2 ，雷电 3 共享 PCIE 3 x4 的 DMI 总线。最后联系了华硕售后（Intel Nuc 业务已经整体卖给了华硕），客服回电告知没有备件，换了 NUC 11 良品，来回免运费。</p></li><li><p>为什么不做存算分离？
空间限制。而且我玩游戏不多，单独配一台游戏PC没有必要，但不能没有。因此把 4060 放在 AIO 里，4060 待机功耗也不高，后面还可以玩一玩本地 LLM 和 blender 渲染。</p></li><li><p>为什么选择 raidz1 ？
mirror 太浪费，raid0 属实亡命之徒，而且我还有一台装了 2T sata 的 J4125小主机，用 Free File Sync 监控 truenas 重要数据文件夹作为备份，兼顾了空间和数据安全。</p></li><li><p>功耗如何？
没有测量过。但 510W 的 UPS 在 AIO 待机状态下显示负载为 10%。游戏满载时负载 35%，NUC 11的 CPU TDP 满载 65W，4060 满载 115W，因此估算待机功耗应该在 60W 左右。</p></li></ul><h2 id=最后>最后<a hidden class=anchor aria-hidden=true href=#最后>#</a></h2><p>起步小白，折腾五个月，还有这样那样的小问题，但总算是能用了，其他的后续慢慢学习优化吧。折腾的时候是真痛苦，折腾完了又感觉索然无味。这台机子还有很大的改进空间，后续也可以加装 40G 网卡真正发挥全闪 nas 的实力。但就目前而言，这台机子最大的缺点在于每次看到它，就让我怀念起那台漂亮的、精致小巧的，但被华硕「友好」回收了的幽灵峡谷。看着越来越大的「NUC」，幽灵峡谷真成绝版了，Sad～～～</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://tannat.me/>tannat</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>